{
  "id": "snapshot_1770927502586_0n8jlhjgj",
  "approvalId": "approval_1770927502576_14aam4b4a",
  "approvalTitle": "Project Structure - Arc42 Node MCP Server",
  "version": 1,
  "timestamp": "2026-02-12T20:18:22.586Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Project Structure\n\n## Directory Organization\n\n```\nArc42-Node-MCP-Server/\n├── src/                        # Source code\n│   ├── index.ts               # Entry point - CLI argument parsing & server startup\n│   ├── server.ts              # MCP server class - tool registration & transport\n│   ├── types.ts               # Shared type definitions & utilities\n│   ├── tools/                 # Tool implementations (one per arc42 operation)\n│   │   ├── index.ts           # Tool registry & dispatch\n│   │   ├── arc42-workflow-guide.ts\n│   │   ├── arc42-init.ts\n│   │   ├── arc42-status.ts\n│   │   ├── generate-template.ts\n│   │   ├── update-section.ts\n│   │   └── get-section.ts\n│   ├── templates/             # Arc42 template content\n│   │   ├── index.ts           # Template exports\n│   │   └── arc42-reference.ts # Arc42 version information\n│   └── __tests__/             # Test files (mirrors source structure)\n│       ├── fixtures/\n│       ├── templates/\n│       └── tools/\n├── dist/                       # Compiled JavaScript output\n├── docs/                       # Documentation\n│   ├── arc42-docs/            # Arc42 documentation for THIS project\n│   └── specs/                 # Feature specifications\n├── scripts/                    # Build and utility scripts\n├── release_notes/              # Version release notes\n├── vendor/                     # Git submodules\n│   └── arc42-template/        # Official arc42 template (submodule)\n├── test-project/               # Test workspace for development\n├── coverage/                   # Test coverage reports\n├── .spec-workflow/             # Spec workflow documentation\n│   ├── steering/              # Steering documents (product, tech, structure)\n│   ├── specs/                 # Feature specifications\n│   └── templates/             # Spec templates\n└── [config files]              # package.json, tsconfig.json, etc.\n```\n\n## Naming Conventions\n\n### Files\n- **Source files**: `kebab-case.ts` (e.g., `arc42-init.ts`, `arc42-workflow-guide.ts`)\n- **Test files**: `kebab-case.test.ts` (e.g., `arc42-init.test.ts`)\n- **Type definitions**: `types.ts` for shared types in each directory\n- **Index files**: `index.ts` for barrel exports\n\n### Code\n- **Classes**: `PascalCase` (e.g., `Arc42MCPServer`)\n- **Types/Interfaces**: `PascalCase` (e.g., `ToolContext`, `Arc42Section`)\n- **Functions**: `camelCase` (e.g., `arc42InitHandler`, `toMCPResponse`)\n- **Constants**: `UPPER_SNAKE_CASE` for arrays/objects (e.g., `ARC42_SECTIONS`, `SECTION_METADATA`)\n- **Type exports**: `PascalCase` (e.g., `type Arc42Section`)\n\n## Import Patterns\n\n### Import Order\n1. External dependencies (`@modelcontextprotocol/sdk`, `zod`, `fs`, `path`)\n2. Internal types (`./types.js`)\n3. Internal modules (`./tools/...`, `./templates/...`)\n\n### Module Organization\n```typescript\n// Standard import pattern for tools\nimport { Tool } from '@modelcontextprotocol/sdk/types.js';\nimport { ToolContext, ToolResponse } from '../types.js';\n```\n\n- **Always use `.js` extension** in imports (required for ESM)\n- **Absolute imports** from `src/` root not used - relative imports preferred\n- **Barrel exports** via `index.ts` for clean imports\n\n## Code Structure Patterns\n\n### Tool Handler Pattern\nEach tool follows this consistent structure:\n\n```typescript\n// src/tools/[tool-name].ts\n\n// 1. Imports\nimport { Tool } from '@modelcontextprotocol/sdk/types.js';\nimport { ToolContext, ToolResponse, resolveWorkspaceRoot } from '../types.js';\n\n// 2. Tool Definition (exported)\nexport const toolNameTool: Tool = {\n  name: 'tool-name',\n  description: '...',\n  inputSchema: { ... }\n};\n\n// 3. Handler Function (exported)\nexport async function toolNameHandler(\n  args: Record<string, unknown>,\n  context: ToolContext\n): Promise<ToolResponse> {\n  // Resolve workspace (supports targetFolder override)\n  const { projectPath, workspaceRoot } = resolveWorkspaceRoot(context, args.targetFolder);\n  \n  // Implementation\n  \n  // Return standard response\n  return {\n    success: true,\n    message: '...',\n    data: { ... },\n    nextSteps: ['...']\n  };\n}\n```\n\n### Response Structure\nAll tools return consistent `ToolResponse`:\n\n```typescript\ninterface ToolResponse {\n  success: boolean;    // Operation status\n  message: string;     // Human-readable result\n  data?: any;          // Structured data (varies by tool)\n  nextSteps?: string[]; // Suggested actions\n}\n```\n\n### Server Pattern\nThe `Arc42MCPServer` class follows:\n\n```typescript\nclass Arc42MCPServer {\n  constructor()     // Initialize MCP server with metadata\n  initialize()      // Setup transport, register tools\n  registerTools()   // Register all tool handlers\n  stop()           // Graceful shutdown\n}\n```\n\n## Module Boundaries\n\n### Core Boundaries\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ Entry Point (index.ts)                                          │\n│ - CLI parsing, server instantiation                             │\n└─────────────────────┬───────────────────────────────────────────┘\n                      │\n┌─────────────────────▼───────────────────────────────────────────┐\n│ Server (server.ts)                                              │\n│ - MCP server lifecycle, tool registration                       │\n│ - Depends on: tools/, types.ts                                  │\n└─────────────────────┬───────────────────────────────────────────┘\n                      │\n┌─────────────────────▼───────────────────────────────────────────┐\n│ Tools (tools/*.ts)                                              │\n│ - Individual tool implementations                               │\n│ - Depends on: types.ts, templates/                              │\n└─────────────────────┬───────────────────────────────────────────┘\n                      │\n┌─────────────────────▼───────────────────────────────────────────┐\n│ Templates (templates/*.ts)                                      │\n│ - Arc42 template content and metadata                           │\n│ - No dependencies on other src modules                          │\n└─────────────────────────────────────────────────────────────────┘\n\n┌─────────────────────────────────────────────────────────────────┐\n│ Types (types.ts) - Shared across all modules                    │\n│ - Interfaces, constants, utility functions                      │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n### Dependency Rules\n- **Templates** → No internal dependencies (pure data)\n- **Types** → No internal dependencies (shared definitions)\n- **Tools** → Can import types.ts, templates/\n- **Server** → Can import tools/, types.ts\n- **Index** → Only imports server.ts\n\n## Code Size Guidelines\n\n- **File size**: ~200-400 lines maximum (tools are typically 50-150 lines)\n- **Function size**: ~50 lines maximum\n- **Tool complexity**: Each tool should do ONE thing well\n- **Nesting depth**: Maximum 3-4 levels of nesting\n\n## Test Structure\n\nTests mirror the source structure:\n\n```\nsrc/__tests__/\n├── fixtures/\n│   └── test-helpers.ts          # Shared test utilities\n├── templates/\n│   ├── arc42-reference.test.ts  # Template version tests\n│   └── index.test.ts            # Template export tests\n├── tools/\n│   ├── arc42-init.test.ts       # Each tool has dedicated test file\n│   ├── arc42-status.test.ts\n│   ├── arc42-workflow-guide.test.ts\n│   ├── generate-template.test.ts\n│   ├── get-section.test.ts\n│   └── update-section.test.ts\n└── types.test.ts                # Type utility tests\n```\n\n### Test Patterns\n- **Unit tests** for individual functions and handlers\n- **Mock file system** for tools that modify files\n- **Consistent test structure**: describe → it → expect\n\n## Documentation Standards\n\n- **Public APIs**: JSDoc comments on exported functions and types\n- **Complex logic**: Inline comments explaining WHY, not WHAT\n- **README files**: Main README.md, docs/ for detailed guides\n- **Code comments**: Use `// NOTE:` for important implementation notes\n- **Type documentation**: Descriptive interface property comments\n\n## Adding New Tools\n\nTo add a new MCP tool:\n\n1. **Create tool file**: `src/tools/new-tool.ts`\n   - Export `newToolTool` (tool definition)\n   - Export `newToolHandler` (handler function)\n\n2. **Register in server**: `src/server.ts`\n   - Import handler\n   - Add `registerTool()` call in `registerTools()`\n\n3. **Add tests**: `src/__tests__/tools/new-tool.test.ts`\n\n4. **Update documentation**: README.md, add tool description\n",
  "fileStats": {
    "size": 10178,
    "lines": 236,
    "lastModified": "2026-02-12T20:18:10.660Z"
  },
  "comments": []
}