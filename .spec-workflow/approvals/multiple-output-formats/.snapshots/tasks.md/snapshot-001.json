{
  "id": "snapshot_1771031936437_0hedtwk25",
  "approvalId": "approval_1771031936431_ww1rldwts",
  "approvalTitle": "Tasks: Multiple Output Formats Implementation (24 tasks in 7 groups)",
  "version": 1,
  "timestamp": "2026-02-14T01:18:56.437Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Implementation Tasks: Multiple Output Formats\n\n## Overview\n\nThis document breaks down the Multiple Output Formats feature into implementable tasks. Tasks follow the design document architecture and implement the requirements with AsciiDoc as the default format.\n\n## Tasks\n\n### Group 1: Core Format Infrastructure\n\n- [ ] 1.1 Create OutputFormatStrategy interface and types in `src/templates/formats/output-format-strategy.ts`\n- [ ] 1.2 Create OutputFormatRegistry class in `src/templates/formats/output-format-registry.ts`\n- [ ] 1.3 Create OutputFormatFactory class in `src/templates/formats/output-format-factory.ts`\n\n### Group 2: Format Strategy Implementations\n\n- [ ] 2.1 Implement MarkdownFormatStrategy in `src/templates/formats/markdown/index.ts`\n- [ ] 2.2 Implement AsciiDocFormatStrategy in `src/templates/formats/asciidoc/index.ts`\n- [ ] 2.3 Create format module index and registration in `src/templates/formats/index.ts`\n\n### Group 3: Unit Tests for Format Infrastructure\n\n- [ ] 3.1 Create OutputFormatStrategy interface tests\n- [ ] 3.2 Create OutputFormatRegistry tests\n- [ ] 3.3 Create OutputFormatFactory tests\n- [ ] 3.4 Create MarkdownFormatStrategy tests\n- [ ] 3.5 Create AsciiDocFormatStrategy tests\n\n### Group 4: Template Provider Integration\n\n- [ ] 4.1 Update types.ts with format type exports\n- [ ] 4.2 Extend LocalizedTemplateProvider with format support\n- [ ] 4.3 Update templates index exports\n\n### Group 5: Tool Updates\n\n- [ ] 5.1 Update arc42-init tool with format parameter\n- [ ] 5.2 Update generate-template tool with format support\n- [ ] 5.3 Update arc42-status tool to detect both formats\n- [ ] 5.4 Update get-section tool for multi-format detection\n- [ ] 5.5 Update update-section tool to maintain existing format\n\n### Group 6: Integration Tests\n\n- [ ] 6.1 Create format integration tests\n- [ ] 6.2 Update existing tool tests for format support\n\n### Group 7: Documentation and Finalization\n\n- [ ] 7.1 Update tool descriptions for format documentation\n- [ ] 7.2 Run full test suite and fix issues\n- [ ] 7.3 Build and verify implementation\n\n## Task Details\n\n### Task 1.1: Create OutputFormatStrategy Interface\n\n_Requirements: Req 1.1, Req 1.3_\n\nCreate `src/templates/formats/output-format-strategy.ts` with:\n- `OutputFormatCode` type: `'markdown' | 'asciidoc'`\n- `SUPPORTED_OUTPUT_FORMAT_CODES` constant array\n- `OUTPUT_FORMAT_ALIASES` mapping for normalization\n- `DEFAULT_OUTPUT_FORMAT` constant as `'asciidoc'`\n- `OutputFormatStrategy` interface with syntax methods:\n  - `code`, `name`, `fileExtension` properties\n  - `formatHeading(text, level)`, `formatBold(text)`, `formatItalic(text)`\n  - `formatCode(code, language?)`, `formatInlineCode(text)`\n  - `formatUnorderedList(items)`, `formatOrderedList(items)`\n  - `formatLink(text, url)`, `formatImage(alt, url)`\n  - `formatTable(headers, rows)`, `formatBlockquote(text)`\n  - `formatHorizontalRule()`, `formatAnchor(id)`\n  - `getReadmeFilename()`, `getSectionFilename(section)`\n\n---\n\n### Task 1.2: Create OutputFormatRegistry Class\n\n_Requirements: Req 2.1, Req 2.4, Req 2.5_\n\nCreate `src/templates/formats/output-format-registry.ts` with:\n- `OutputFormatRegistry` class matching `LanguageRegistry` pattern\n- `normalizeCode(code)` private method for case-insensitive lookup\n- `register(strategy)` method with method chaining\n- `get(code)` method returning strategy or undefined\n- `getOrThrow(code)` method with descriptive error\n- `getAll()` method returning array of strategies\n- `isSupported(code)` method for checking support\n- `getAvailableCodes()` method returning format codes\n- `getDefault()` method returning AsciiDoc strategy\n- `size` getter and `clear()` method\n\n---\n\n### Task 1.3: Create OutputFormatFactory Class\n\n_Requirements: Req 1.5, Req 2.2, Req 2.3_\n\nCreate `src/templates/formats/output-format-factory.ts` with:\n- `OutputFormatFactory` class matching `LanguageFactory` pattern\n- Constructor accepting `OutputFormatRegistry`\n- `normalizeCode(code)` using `OUTPUT_FORMAT_ALIASES`\n- `create(code)` method using registry lookup\n- `createWithFallback(code)` with AsciiDoc fallback and warning\n- `isSupported(code)` method\n- `getAvailableCodes()` method\n- `getDefault()` returning AsciiDoc strategy\n\n---\n\n### Task 2.1: Implement MarkdownFormatStrategy\n\n_Requirements: Req 3.1, Req 3.2, Req 3.3, Req 3.4_\n\nCreate `src/templates/formats/markdown/index.ts` with:\n- `MarkdownFormatStrategy` class implementing `OutputFormatStrategy`\n- `code = 'markdown'`, `name = 'Markdown'`, `fileExtension = '.md'`\n- `formatHeading(text, level)`: `#`.repeat(level) + ` ${text}`\n- `formatBold(text)`: `**${text}**`\n- `formatItalic(text)`: `*${text}*`\n- `formatCode(code, language?)`: triple backticks with language\n- `formatInlineCode(text)`: single backticks\n- `formatUnorderedList(items)`: `- item` format\n- `formatOrderedList(items)`: `1. item` format\n- `formatLink(text, url)`: `[text](url)`\n- `formatImage(alt, url)`: `![alt](url)`\n- `formatTable(headers, rows)`: pipe-separated table\n- `formatBlockquote(text)`: `> text`\n- `formatHorizontalRule()`: `---`\n- `formatAnchor(id)`: empty string\n- `getReadmeFilename()`: `README.md`\n- `getSectionFilename(section)`: `${section}.md`\n\n---\n\n### Task 2.2: Implement AsciiDocFormatStrategy\n\n_Requirements: Req 4.1-4.10_\n\nCreate `src/templates/formats/asciidoc/index.ts` with:\n- `AsciiDocFormatStrategy` class implementing `OutputFormatStrategy`\n- `code = 'asciidoc'`, `name = 'AsciiDoc'`, `fileExtension = '.adoc'`\n- `formatHeading(text, level)`: `=`.repeat(level) + ` ${text}`\n- `formatBold(text)`: `*${text}*`\n- `formatItalic(text)`: `_${text}_`\n- `formatCode(code, language?)`: `[source,lang]` + `----` block\n- `formatInlineCode(text)`: backticks\n- `formatUnorderedList(items)`: `* item` format\n- `formatOrderedList(items)`: `. item` format\n- `formatLink(text, url)`: `link:url[text]`\n- `formatImage(alt, url)`: `image::url[alt]`\n- `formatTable(headers, rows)`: AsciiDoc table with `|===`\n- `formatBlockquote(text)`: `____` block\n- `formatHorizontalRule()`: `'''`\n- `formatAnchor(id)`: `[[id]]`\n- `getReadmeFilename()`: `README.adoc`\n- `getSectionFilename(section)`: `${section}.adoc`\n\n---\n\n### Task 2.3: Create Format Module Index\n\n_Requirements: Req 1.4, Req 2.1_\n\nCreate `src/templates/formats/index.ts` with:\n- Import all format strategies\n- Create and export `outputFormatRegistry` singleton\n- Register MarkdownFormatStrategy and AsciiDocFormatStrategy\n- Create and export `outputFormatFactory` singleton\n- Export all types, constants, and utilities\n- Add `isOutputFormatCode()` and `normalizeOutputFormatCode()` helpers\n\n---\n\n### Task 3.1: Create OutputFormatStrategy Tests\n\nCreate `src/__tests__/templates/formats/output-format-strategy.test.ts` with:\n- Test type definitions are correct\n- Test constant values are correct\n- Test alias mappings cover expected cases\n\n---\n\n### Task 3.2: Create OutputFormatRegistry Tests\n\nCreate `src/__tests__/templates/formats/output-format-registry.test.ts` with:\n- Test registration with method chaining\n- Test case-insensitive lookup\n- Test `getOrThrow` error messages\n- Test `getAll()` returns all strategies\n- Test `isSupported()` returns correct boolean\n- Test `getAvailableCodes()` returns all codes\n- Test `getDefault()` returns AsciiDoc\n- Test `size` getter and `clear()` method\n\n---\n\n### Task 3.3: Create OutputFormatFactory Tests\n\nCreate `src/__tests__/templates/formats/output-format-factory.test.ts` with:\n- Test code normalization with aliases\n- Test `create()` returns correct strategy\n- Test `createWithFallback()` returns AsciiDoc for unknown\n- Test `isSupported()` returns correct boolean\n- Test `getDefault()` returns AsciiDoc\n\n---\n\n### Task 3.4: Create MarkdownFormatStrategy Tests\n\nCreate `src/__tests__/templates/formats/markdown/markdown-strategy.test.ts` with:\n- Test all formatting methods produce correct Markdown syntax\n- Test headings at all levels (1-6)\n- Test code blocks with and without language\n- Test table generation\n- Test file naming methods\n\n---\n\n### Task 3.5: Create AsciiDocFormatStrategy Tests\n\nCreate `src/__tests__/templates/formats/asciidoc/asciidoc-strategy.test.ts` with:\n- Test all formatting methods produce correct AsciiDoc syntax\n- Test headings at all levels (1-6)\n- Test code blocks with and without language\n- Test table generation with AsciiDoc syntax\n- Test anchor generation\n- Test file naming methods\n\n---\n\n### Task 4.1: Update types.ts\n\nModify `src/types.ts` to add:\n- `OutputFormatCode` type export\n- `SUPPORTED_OUTPUT_FORMAT_CODES` export\n- `DEFAULT_OUTPUT_FORMAT` export\n- `OutputFormatStrategy` type export\n\n---\n\n### Task 4.2: Extend LocalizedTemplateProvider\n\n_Requirements: Req 5.3, Req 5.4_\n\nModify `src/templates/locales/template-provider.ts` to add:\n- Import `outputFormatFactory` from formats module\n- `getFormatStrategy(format?: string)` method\n- `getFormattedTemplate(section, language?, format?)` method\n- `getFormattedReadmeContent(language?, format?, projectName?)` method\n- `readFormatFromConfig(workspacePath)` helper method\n\n---\n\n### Task 4.3: Update Templates Index\n\nModify `src/templates/index.ts` to:\n- Add exports from `./formats/index.js`\n- Export format-related types and utilities\n\n---\n\n### Task 5.1: Update arc42-init Tool\n\n_Requirements: Req 5.1, Req 5.2, Req 6.1_\n\nModify `src/tools/arc42-init.ts` to:\n- Import format utilities from templates\n- Add `format` parameter to input schema (default: 'asciidoc')\n- Update config.yaml generation to include format\n- Update README file creation to use format strategy\n- Update section files to use correct extension\n- Update main documentation file creation\n\n---\n\n### Task 5.2: Update generate-template Tool\n\n_Requirements: Req 5.4, Req 6.2_\n\nModify `src/tools/generate-template.ts` to:\n- Import format utilities from templates\n- Add `format` parameter to input schema (optional)\n- Read format from config.yaml if not specified\n- Generate templates using the format strategy\n- Update output to use correct file extension\n\n---\n\n### Task 5.3: Update arc42-status Tool\n\n_Requirements: Req 6.5_\n\nModify `src/tools/arc42-status.ts` to:\n- Update file detection to check both `.md` and `.adoc` extensions\n- Report detected format in status output\n- Handle mixed-format projects gracefully\n\n---\n\n### Task 5.4: Update get-section Tool\n\n_Requirements: Req 6.4_\n\nModify `src/tools/get-section.ts` to:\n- Update file detection to find both `.md` and `.adoc` files\n- Return content regardless of format\n\n---\n\n### Task 5.5: Update update-section Tool\n\n_Requirements: Req 6.3_\n\nModify `src/tools/update-section.ts` to:\n- Detect existing file format from extension\n- Maintain existing format when updating\n\n---\n\n### Task 6.1: Create Format Integration Tests\n\nCreate `src/__tests__/tools/format-integration.test.ts` with:\n- Test `arc42-init` creates files in AsciiDoc format by default\n- Test `arc42-init` creates files in Markdown format when specified\n- Test `generate-template` respects config format\n- Test `arc42-status` detects both formats\n- Test format persistence across tool calls\n\n---\n\n### Task 6.2: Update Existing Tool Tests\n\nModify existing test files:\n- `src/__tests__/tools/arc42-init.test.ts` for format support\n- `src/__tests__/tools/generate-template.test.ts` for format support\n- `src/__tests__/tools/arc42-status.test.ts` for format detection\n\n---\n\n### Task 7.1: Update Tool Descriptions\n\nModify tool files:\n- `src/tools/arc42-init.ts` description for format parameter\n- `src/tools/generate-template.ts` description for format parameter\n- `src/tools/arc42-workflow-guide.ts` to document format selection\n\n---\n\n### Task 7.2: Run Full Test Suite\n\n- Run `npm test` and ensure all tests pass\n- Run `npm run test:coverage` and verify coverage thresholds\n- Fix any failing tests or coverage gaps\n\n---\n\n### Task 7.3: Build and Verify\n\n- Run `npm run build` and ensure no TypeScript errors\n- Test manual workflow with MCP client\n- Verify AsciiDoc output is valid\n\n## Task Dependencies\n\n```\n1.1 ──┬──> 1.2 ──┬──> 1.3 ──┬──> 2.3\n      │         │          │\n      └──> 2.1 ─┘          │\n      │                    │\n      └──> 2.2 ────────────┘\n                           │\n                           v\n           3.1 ────────────┬──> 4.1\n           3.2 ────────────┤\n           3.3 ────────────┤\n           3.4 ────────────┤\n           3.5 ────────────┘\n                           │\n                           v\n           4.2 ────────────┬──> 4.3\n                           │\n                           v\n           5.1 ──> 5.2 ──> 5.3 ──> 5.4 ──> 5.5\n                           │\n                           v\n           6.1 ────────────┴────> 6.2\n                                  │\n                                  v\n           7.1 ──> 7.2 ──> 7.3\n```\n\n## Summary\n\n| Group | Description | Tasks |\n|-------|-------------|-------|\n| 1 | Core Infrastructure | 3 |\n| 2 | Format Implementations | 3 |\n| 3 | Unit Tests | 5 |\n| 4 | Template Provider | 3 |\n| 5 | Tool Updates | 5 |\n| 6 | Integration Tests | 2 |\n| 7 | Finalization | 3 |\n\n**Total Tasks: 24**\n",
  "fileStats": {
    "size": 13253,
    "lines": 406,
    "lastModified": "2026-02-14T01:18:50.085Z"
  },
  "comments": []
}