{
  "id": "snapshot_1771030214211_webohwqd6",
  "approvalId": "approval_1771030214194_ls9uc94kk",
  "approvalTitle": "Requirements: Multiple Output Formats (Markdown + AsciiDoc)",
  "version": 1,
  "timestamp": "2026-02-14T00:50:14.211Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Multiple Output Formats\n\n## Introduction\n\nThe Multiple Output Formats feature enables the Arc42 Node MCP Server to generate architecture documentation in different file formats beyond the current Markdown support. This feature specifically introduces AsciiDoc format support while establishing an extensible architecture that allows adding additional formats (such as reStructuredText, HTML, or custom formats) in the future.\n\nThe core value is flexibility: while Markdown is excellent for GitHub and many modern tools, some organizations and documentation platforms prefer or require AsciiDoc (especially in Java/enterprise ecosystems where tools like Asciidoctor are prevalent). This feature makes arc42 documentation accessible to a broader range of teams and toolchains.\n\n## Alignment with Product Vision\n\nThis feature directly supports multiple product principles from product.md:\n\n1. **AI-First Design**: All format strategies will provide structured outputs optimized for AI assistant usage with consistent interfaces\n2. **Standards Compliance**: Both Markdown and AsciiDoc will faithfully implement the arc42 template structure\n3. **Minimal Friction**: Format selection will be seamless via configuration or tool parameters\n4. **Progressive Documentation**: Users can switch formats without losing content or starting over\n\nThis feature is explicitly listed in the \"Future Vision > Potential Enhancements\" section of product.md:\n> \"Multiple Output Formats: Support for different documentation file formats (Markdown, AsciiDoc) with potential for additional formats in the future\"\n\n## Requirements\n\n### Requirement 1: Format Strategy Architecture\n\n**User Story:** As a developer maintaining the arc42 MCP server, I want a pluggable format architecture using the Strategy pattern, so that new formats can be added without modifying existing code (Open/Closed Principle).\n\n#### Acceptance Criteria\n\n1. WHEN the system is designed THEN it SHALL define a `FormatStrategy` interface with methods for generating formatted content\n2. WHEN a new format is added THEN the system SHALL NOT require modifications to existing format implementations\n3. WHEN a format strategy is implemented THEN it SHALL provide methods for:\n   - Converting plain text to formatted equivalents (headings, lists, code blocks, etc.)\n   - Generating section files with proper formatting\n   - Generating README files with proper formatting\n4. IF a format strategy is registered THEN it SHALL be discoverable through a `FormatRegistry`\n5. WHEN format strategies are created THEN a `FormatFactory` SHALL instantiate them with fallback to Markdown for unknown formats\n\n### Requirement 2: Format Registry and Factory\n\n**User Story:** As a developer, I want centralized format management through Registry and Factory patterns, so that format lookup and creation follows the same proven pattern as the multi-language feature.\n\n#### Acceptance Criteria\n\n1. WHEN the system initializes THEN it SHALL create a `FormatRegistry` to store all available format strategies\n2. WHEN a format is requested THEN the `FormatFactory` SHALL normalize the format code (e.g., \"markdown\", \"MARKDOWN\", \"md\" → \"markdown\")\n3. IF an unknown format is requested THEN the factory SHALL fall back to Markdown with a warning\n4. WHEN formats are registered THEN the registry SHALL support case-insensitive lookup\n5. WHEN querying available formats THEN the system SHALL return all registered format codes and their display names\n\n### Requirement 3: Markdown Format Strategy\n\n**User Story:** As a user of the current system, I want existing Markdown functionality to work exactly as before, so that the format refactoring doesn't break current workflows.\n\n#### Acceptance Criteria\n\n1. WHEN the Markdown strategy is used THEN it SHALL produce identical output to the current implementation\n2. WHEN generating section files THEN the Markdown strategy SHALL use `#` for headings, backticks for code blocks, and `-` for lists\n3. WHEN generating README files THEN the Markdown strategy SHALL create `.md` files\n4. WHEN file extensions are requested THEN the Markdown strategy SHALL return `.md`\n5. IF no format is specified THEN Markdown SHALL be the default format\n\n### Requirement 4: AsciiDoc Format Strategy\n\n**User Story:** As a technical writer using AsciiDoc-based documentation platforms, I want arc42 documentation generated in AsciiDoc format, so that it integrates seamlessly with our existing documentation toolchain.\n\n#### Acceptance Criteria\n\n1. WHEN the AsciiDoc strategy is used THEN it SHALL generate valid AsciiDoc syntax\n2. WHEN generating headings THEN the AsciiDoc strategy SHALL use `=` prefix notation (e.g., `= Title`, `== Section`, `=== Subsection`)\n3. WHEN generating code blocks THEN the AsciiDoc strategy SHALL use `[source,language]` with `----` delimiters\n4. WHEN generating lists THEN the AsciiDoc strategy SHALL use `*` for unordered lists and `.` for ordered lists\n5. WHEN generating file extensions THEN the AsciiDoc strategy SHALL return `.adoc`\n6. WHEN generating bold text THEN the AsciiDoc strategy SHALL use `*bold*` syntax\n7. WHEN generating italic text THEN the AsciiDoc strategy SHALL use `_italic_` syntax\n8. WHEN generating section anchors THEN the AsciiDoc strategy SHALL use `[[anchor-name]]` syntax\n9. WHEN generating README files THEN the AsciiDoc strategy SHALL create `README.adoc` files\n\n### Requirement 5: Format Configuration\n\n**User Story:** As a user initializing arc42 documentation, I want to specify my preferred output format, so that all generated files use my chosen format consistently.\n\n#### Acceptance Criteria\n\n1. WHEN running `arc42-init` THEN the tool SHALL accept an optional `format` parameter\n2. WHEN a format is specified in `arc42-init` THEN it SHALL be written to `config.yaml`\n3. WHEN reading config.yaml THEN the system SHALL read the `format` field (defaulting to \"markdown\" if not present)\n4. WHEN generating templates THEN the system SHALL use the format from config.yaml or fall back to Markdown\n5. IF an unsupported format is in config.yaml THEN the system SHALL warn and fall back to Markdown\n\n### Requirement 6: Tool Integration\n\n**User Story:** As an AI assistant using the arc42 MCP tools, I want all existing tools to respect the configured format, so that documentation remains consistent throughout the project lifecycle.\n\n#### Acceptance Criteria\n\n1. WHEN `arc42-init` runs THEN it SHALL create section files and README in the configured format\n2. WHEN `generate-template` runs THEN it SHALL generate templates in the configured format\n3. WHEN `update-section` runs THEN it SHALL maintain the existing file format (based on file extension)\n4. WHEN `get-section` runs THEN it SHALL read files regardless of format\n5. WHEN `arc42-status` runs THEN it SHALL detect completion status for all format extensions (`.md`, `.adoc`)\n\n### Requirement 7: Backward Compatibility\n\n**User Story:** As an existing user with Markdown documentation, I want the system to continue working without any changes to my existing projects, so that the new feature doesn't disrupt my workflow.\n\n#### Acceptance Criteria\n\n1. WHEN existing Markdown projects are used THEN they SHALL continue to work without modification\n2. WHEN config.yaml has no `format` field THEN the system SHALL default to Markdown\n3. WHEN existing tools are called without format parameters THEN they SHALL use Markdown as before\n4. WHEN the multi-language feature is used THEN it SHALL work with any output format\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Strategy Pattern**: Format strategies SHALL follow the Strategy pattern, similar to the existing `LanguageStrategy` implementation\n- **Single Responsibility Principle**: Each format strategy SHALL only handle format-specific syntax generation\n- **Open/Closed Principle**: New formats SHALL be addable without modifying existing format implementations\n- **Registry Pattern**: Format discovery SHALL use a centralized registry, matching the `LanguageRegistry` pattern\n- **Factory Pattern**: Format instantiation SHALL use a factory with normalization and fallback logic\n- **Dependency Inversion**: Tools SHALL depend on the `FormatStrategy` interface, not concrete implementations\n- **DRY Principle**: Format constants and common logic SHALL be defined once and reused\n- **Interface Segregation**: Format strategies SHALL implement a focused interface with only necessary methods\n\n### Performance\n\n- Format strategy creation SHALL have O(1) lookup time through registry Map storage\n- Format conversion SHALL not significantly impact tool response times (< 50ms overhead)\n- Registry SHALL be initialized once at server startup, not per-request\n\n### Security\n\n- Format strategies SHALL NOT execute arbitrary code during content generation\n- File extensions SHALL be validated to prevent path traversal attacks\n- Format codes SHALL be validated against a whitelist before use\n\n### Reliability\n\n- IF a format strategy fails THEN the system SHALL fall back to Markdown gracefully\n- Format strategies SHALL be unit tested with >90% coverage\n- Invalid format configurations SHALL produce clear error messages\n- Existing functionality SHALL remain 100% functional (backward compatibility)\n\n### Usability\n\n- Format names SHALL be intuitive and follow common conventions (\"markdown\", \"asciidoc\")\n- Format selection SHALL support common aliases (e.g., \"md\" → \"markdown\", \"adoc\" → \"asciidoc\")\n- Error messages SHALL suggest available formats when an unknown format is requested\n- Documentation SHALL explain how to add new formats in the future\n\n### Testability\n\n- Each format strategy SHALL have dedicated unit tests covering all syntax conversions\n- Integration tests SHALL verify format strategies work with all tools\n- Test coverage SHALL meet project standards (statements: 80%, functions: 90%)\n- Mock format strategies SHALL be available for testing tools without file I/O\n",
  "fileStats": {
    "size": 9954,
    "lines": 158,
    "lastModified": "2026-02-14T00:50:10.429Z"
  },
  "comments": []
}