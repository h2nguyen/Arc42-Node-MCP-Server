{
  "id": "snapshot_1770928739264_xevw1wsuf",
  "approvalId": "approval_1770928739245_s2e2pv5ca",
  "approvalTitle": "Design: Multi-Language Template Support",
  "version": 1,
  "timestamp": "2026-02-12T20:38:59.264Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document: Multi-Language Template Support\n\n## Overview\n\nThis design document describes the technical implementation of multi-language support for the Arc42 Node MCP Server. The feature enables users to generate and manage architecture documentation in any of the 11 languages supported by the official arc42 template repository.\n\nThe implementation uses established design patterns (Strategy, Factory, Registry, Provider) to ensure maintainability, testability, and extensibility, allowing new languages to be added without modifying core code.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n- **TypeScript 5.7**: All new code will be written in TypeScript with strict type checking\n- **ES Modules**: Use ESM with `.js` extensions in imports\n- **Zod Validation**: Language code parameters will be validated using Zod schemas\n- **MCP SDK**: Tool parameter schemas will be extended to include `language` option\n- **File-based Storage**: Language templates stored as TypeScript modules (no external files at runtime)\n\n### Project Structure (structure.md)\n\nFollowing the established patterns:\n- **kebab-case** file naming: `language-strategy.ts`, `template-provider.ts`\n- **PascalCase** for types/interfaces: `LanguageStrategy`, `LanguageRegistry`\n- **Tool Handler Pattern**: Extend existing handlers with language-aware logic\n- **Barrel exports** via `index.ts` for clean imports\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **`src/types.ts`**: Extend with language-related types and constants\n- **`src/templates/index.ts`**: Current English templates as base for localization\n- **`src/tools/arc42-init.ts`**: Extend to accept `language` parameter\n- **`src/tools/generate-template.ts`**: Extend to read project language config\n- **`src/tools/arc42-status.ts`**: Extend to display configured language\n- **`resolveWorkspaceRoot()`**: Reuse for config file path resolution\n\n### Integration Points\n\n- **config.yaml**: Add `language` field to persist user preference\n- **MCP Tool Registration**: Add `language` parameter to tool schemas in `server.ts`\n- **Existing Templates**: Refactor English templates to be language-strategy implementation\n\n## Architecture\n\n### High-Level Architecture\n\n```mermaid\ngraph TD\n    subgraph \"MCP Layer\"\n        A[arc42-init Tool] --> B[arc42-status Tool]\n        A --> C[generate-template Tool]\n    end\n    \n    subgraph \"Language Layer\"\n        D[LanguageRegistry]\n        E[LanguageFactory]\n        F[TemplateProvider]\n    end\n    \n    subgraph \"Strategy Implementations\"\n        G[EnglishStrategy]\n        H[GermanStrategy]\n        I[FrenchStrategy]\n        J[...Other Languages]\n    end\n    \n    A --> E\n    C --> F\n    E --> D\n    F --> D\n    D --> G\n    D --> H\n    D --> I\n    D --> J\n    \n    subgraph \"Data Layer\"\n        K[config.yaml]\n        L[Localized Templates]\n    end\n    \n    F --> L\n    A --> K\n```\n\n### Design Pattern Implementation\n\n```mermaid\nclassDiagram\n    class LanguageStrategy {\n        <<interface>>\n        +code: string\n        +name: string\n        +getSectionTitle(section: Arc42Section): string\n        +getSectionDescription(section: Arc42Section): string\n        +getTemplate(section: Arc42Section): string\n        +getWorkflowGuide(): string\n    }\n    \n    class LanguageRegistry {\n        -strategies: Map~string, LanguageStrategy~\n        +register(strategy: LanguageStrategy): void\n        +get(code: string): LanguageStrategy\n        +getAll(): LanguageStrategy[]\n        +isSupported(code: string): boolean\n        +getAvailableCodes(): string[]\n    }\n    \n    class LanguageFactory {\n        -registry: LanguageRegistry\n        +create(code: string): LanguageStrategy\n        +createWithFallback(code: string): LanguageStrategy\n        +normalizeCode(code: string): string\n    }\n    \n    class TemplateProvider {\n        <<interface>>\n        +getTemplate(section: Arc42Section, language?: string): string\n        +getSectionMetadata(section: Arc42Section, language?: string): SectionMetadata\n    }\n    \n    class LocalizedTemplateProvider {\n        -factory: LanguageFactory\n        -configReader: ConfigReader\n        +getTemplate(section: Arc42Section, language?: string): string\n        +getSectionMetadata(section: Arc42Section, language?: string): SectionMetadata\n    }\n    \n    LanguageStrategy <|.. EnglishStrategy\n    LanguageStrategy <|.. GermanStrategy\n    LanguageStrategy <|.. OtherStrategies\n    LanguageRegistry o-- LanguageStrategy\n    LanguageFactory --> LanguageRegistry\n    LocalizedTemplateProvider ..|> TemplateProvider\n    LocalizedTemplateProvider --> LanguageFactory\n```\n\n## Components and Interfaces\n\n### Component 1: LanguageStrategy Interface\n\n**File:** `src/templates/locales/language-strategy.ts`\n\n- **Purpose:** Defines the contract for all language implementations\n- **Interfaces:**\n  ```typescript\n  interface LanguageStrategy {\n    readonly code: string;           // e.g., \"DE\", \"EN\"\n    readonly name: string;           // e.g., \"German\", \"English\"\n    readonly nativeName: string;     // e.g., \"Deutsch\", \"English\"\n    \n    getSectionTitle(section: Arc42Section): string;\n    getSectionDescription(section: Arc42Section): string;\n    getTemplate(section: Arc42Section): string;\n    getWorkflowGuide(): string;\n    getReadmeContent(projectName: string): string;\n  }\n  ```\n- **Dependencies:** `Arc42Section` from `types.ts`\n- **Reuses:** Section enumeration from existing types\n\n### Component 2: LanguageRegistry\n\n**File:** `src/templates/locales/language-registry.ts`\n\n- **Purpose:** Maintains catalog of all available languages, provides discovery and validation\n- **Interfaces:**\n  ```typescript\n  class LanguageRegistry {\n    register(strategy: LanguageStrategy): void;\n    get(code: string): LanguageStrategy | undefined;\n    getOrThrow(code: string): LanguageStrategy;\n    getAll(): LanguageStrategy[];\n    isSupported(code: string): boolean;\n    getAvailableCodes(): string[];\n    getDefault(): LanguageStrategy;\n  }\n  ```\n- **Dependencies:** `LanguageStrategy`\n- **Reuses:** None (new component)\n\n### Component 3: LanguageFactory\n\n**File:** `src/templates/locales/language-factory.ts`\n\n- **Purpose:** Creates language strategy instances with normalization and fallback logic\n- **Interfaces:**\n  ```typescript\n  class LanguageFactory {\n    constructor(registry: LanguageRegistry);\n    create(code: string): LanguageStrategy;\n    createWithFallback(code: string): LanguageStrategy;\n    normalizeCode(code: string): string;\n  }\n  ```\n- **Dependencies:** `LanguageRegistry`\n- **Reuses:** None (new component)\n\n### Component 4: LocalizedTemplateProvider\n\n**File:** `src/templates/locales/template-provider.ts`\n\n- **Purpose:** Provides language-aware template access with config integration\n- **Interfaces:**\n  ```typescript\n  interface TemplateProvider {\n    getTemplate(section: Arc42Section, language?: string): string;\n    getSectionMetadata(section: Arc42Section, language?: string): LocalizedSectionMetadata;\n    getAvailableLanguages(): LanguageInfo[];\n  }\n  \n  class LocalizedTemplateProvider implements TemplateProvider {\n    constructor(factory: LanguageFactory);\n    getTemplate(section: Arc42Section, language?: string): string;\n    getSectionMetadata(section: Arc42Section, language?: string): LocalizedSectionMetadata;\n    getAvailableLanguages(): LanguageInfo[];\n  }\n  ```\n- **Dependencies:** `LanguageFactory`, `ConfigReader`\n- **Reuses:** Existing config.yaml reading logic\n\n### Component 5: Language Strategy Implementations\n\n**Files:** `src/templates/locales/{code}/index.ts` (one per language)\n\n- **Purpose:** Concrete implementations for each supported language\n- **Structure per language:**\n  ```\n  src/templates/locales/\n  ├── en/\n  │   ├── index.ts          # EnglishStrategy export\n  │   ├── sections.ts       # Section titles and descriptions\n  │   └── templates.ts      # Full template content\n  ├── de/\n  │   ├── index.ts          # GermanStrategy export\n  │   ├── sections.ts\n  │   └── templates.ts\n  └── [11 language folders]\n  ```\n- **Reuses:** Existing English templates refactored into this structure\n\n## Data Models\n\n### LanguageInfo\n\n```typescript\ninterface LanguageInfo {\n  code: string;           // \"EN\", \"DE\", etc.\n  name: string;           // \"English\", \"German\"\n  nativeName: string;     // \"English\", \"Deutsch\"\n}\n```\n\n### LocalizedSectionMetadata\n\n```typescript\ninterface LocalizedSectionMetadata {\n  name: string;           // Section filename (unchanged)\n  title: string;          // Localized title\n  description: string;    // Localized description\n  order: number;          // Section order (unchanged)\n}\n```\n\n### Extended Config.yaml\n\n```yaml\nproject:\n  name: \"My Project\"\n  version: \"1.0.0\"\n  language: \"DE\"          # NEW: Language setting\n  created: \"2026-02-12\"\n```\n\n### Extended Tool Parameters\n\n```typescript\n// arc42-init extended schema\n{\n  projectName: z.string(),\n  force: z.boolean().optional(),\n  targetFolder: z.string().optional(),\n  language: z.string().optional()  // NEW\n}\n\n// generate-template extended schema\n{\n  section: z.enum(ARC42_SECTIONS),\n  language: z.string().optional()  // NEW\n}\n```\n\n## File Structure\n\n```\nsrc/\n├── templates/\n│   ├── index.ts                    # Re-export LocalizedTemplateProvider\n│   ├── arc42-reference.ts          # Version info (unchanged)\n│   └── locales/\n│       ├── index.ts                # Registry, Factory, Provider exports\n│       ├── language-strategy.ts    # Interface definition\n│       ├── language-registry.ts    # Registry implementation\n│       ├── language-factory.ts     # Factory implementation\n│       ├── template-provider.ts    # Provider implementation\n│       ├── en/\n│       │   ├── index.ts            # Export EnglishStrategy\n│       │   ├── sections.ts         # Section metadata\n│       │   └── templates.ts        # Template content\n│       ├── cz/\n│       │   └── [same structure]\n│       ├── de/\n│       │   └── [same structure]\n│       ├── es/\n│       │   └── [same structure]\n│       ├── fr/\n│       │   └── [same structure]\n│       ├── it/\n│       │   └── [same structure]\n│       ├── nl/\n│       │   └── [same structure]\n│       ├── pt/\n│       │   └── [same structure]\n│       ├── ru/\n│       │   └── [same structure]\n│       ├── ukr/\n│       │   └── [same structure]\n│       └── zh/\n│           └── [same structure]\n├── tools/\n│   ├── arc42-init.ts              # Modified: add language parameter\n│   ├── arc42-status.ts            # Modified: display language\n│   └── generate-template.ts       # Modified: language-aware\n└── types.ts                       # Extended with language types\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Unsupported Language Code**\n   - **Handling:** Return error with list of valid codes\n   - **User Impact:** Clear message: \"Unsupported language 'XX'. Available: EN, CZ, DE, ES, FR, IT, NL, PT, RU, UKR, ZH\"\n\n2. **Missing Template Content**\n   - **Handling:** Fall back to English with warning in response\n   - **User Impact:** Template generated in English with note: \"Template not available in 'XX', using English fallback\"\n\n3. **Corrupted config.yaml Language**\n   - **Handling:** Ignore invalid value, use English default\n   - **User Impact:** Silent fallback, status shows \"EN (default)\"\n\n4. **Case Mismatch in Language Code**\n   - **Handling:** Normalize to uppercase automatically\n   - **User Impact:** Transparent - \"de\" treated same as \"DE\"\n\n## Testing Strategy\n\n### Unit Testing\n\n**Files:** `src/__tests__/templates/locales/*.test.ts`\n\n- Test `LanguageRegistry`:\n  - Registration of strategies\n  - Lookup by code (case-insensitive)\n  - `isSupported()` validation\n  - `getAll()` returns all registered\n\n- Test `LanguageFactory`:\n  - Code normalization (case handling)\n  - Fallback to English for unknown codes\n  - Creation of correct strategy type\n\n- Test `LocalizedTemplateProvider`:\n  - Returns correct template for language\n  - Config override by parameter\n  - Fallback behavior\n\n- Test each `LanguageStrategy`:\n  - All 12 sections have titles\n  - All 12 sections have descriptions\n  - Templates contain valid markdown\n\n### Integration Testing\n\n**Files:** `src/__tests__/tools/*.test.ts` (extend existing)\n\n- Test `arc42-init` with language:\n  - Creates files with localized content\n  - Saves language to config.yaml\n  - Defaults to EN when not specified\n\n- Test `generate-template` with language:\n  - Reads language from config\n  - Parameter overrides config\n  - Works for all 11 languages\n\n- Test `arc42-status` with language:\n  - Displays configured language\n  - Shows \"EN (default)\" when not set\n\n### End-to-End Testing\n\n- Initialize project in German → verify all files German\n- Initialize project in Chinese → verify Chinese content\n- Initialize without language → verify English default\n- Change language mid-project via parameter override\n",
  "fileStats": {
    "size": 13182,
    "lines": 408,
    "lastModified": "2026-02-12T20:38:46.867Z"
  },
  "comments": []
}